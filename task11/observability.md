# Observability MongoDB Schema Documentation

## Collections

### 1. `monitoring_events`
Stores events generated by the observability system.

#### Schema
```json
{
  "_id": "ObjectId",
  "eventId": "string", // Unique identifier for the event
  "type": "string", // Type of the event (e.g., "error", "performance")
  "details": "object", // Additional details about the event
  "source": "string", // Source system or component
  "createdAt": "timestamp",
  "processedAt": "timestamp", // Optional, marks when the event was processed
  "status": "string" // e.g., "new", "processed", "ignored"
}
```

#### Indexes
- **Single index** on `eventId`:
  ```javascript
  db.monitoring_events.createIndex({ "eventId": 1 });
  ```
  Ensures quick retrieval by event ID.
- **Compound index** on `type` and `status`:
  ```javascript
  db.monitoring_events.createIndex({ "type": 1, "status": 1 });
  ```
  Optimizes filtering events by type and status.

### 2. `observability_systems`
Stores details about observability systems integrated with the service.

#### Schema
```json
{
  "_id": "ObjectId",
  "systemId": "string", // Unique identifier for the system
  "name": "string", // System name
  "description": "string", // Description of the observability system
  "isActive": "boolean", // Whether the system is currently active
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
```

#### Indexes
- **Single index** on `systemId`:
  ```javascript
  db.observability_systems.createIndex({ "systemId": 1 });
  ```
  Ensures quick lookups by system ID.
- **Single index** on `isActive`:
  ```javascript
  db.observability_systems.createIndex({ "isActive": 1 });
  ```
  Facilitates fetching only active systems.

### 3. `event_processing_logs`
Logs the processing history of monitoring events.

#### Schema
```json
{
  "_id": "ObjectId",
  "eventId": "string", // ID of the monitored event
  "processor": "string", // Processor or system handling the event
  "status": "string", // Status of the event after processing (e.g., "success", "failure")
  "processedAt": "timestamp", // Timestamp of processing
  "details": "object" // Additional details or logs related to processing
}
```

#### Indexes
- **Compound index** on `eventId` and `processedAt`:
  ```javascript
  db.event_processing_logs.createIndex({ "eventId": 1, "processedAt": -1 });
  ```
  Optimizes retrieving logs for specific events, sorted by the latest processing time.

## Key Selection and Query Patterns

### Key Selections:
- **Primary Key (_id)**: Automatically indexed and used for unique identification of documents.
- **Indexes**:
  - `monitoring_events`: Single on `eventId`, compound on `type` and `status`.
  - `observability_systems`: Single on `systemId`, single on `isActive`.
  - `event_processing_logs`: Compound on `eventId` and `processedAt`.

### Query Patterns:
1. **Retrieve events of a specific type and status**:
   ```javascript
   db.monitoring_events.find({ "type": "performance", "status": "new" });
   ```

2. **Get an active observability system**:
   ```javascript
   db.observability_systems.findOne({ "isActive": true });
   ```

3. **Fetch logs for a specific event**:
   ```javascript
   db.event_processing_logs.find({ "eventId": "<EVENT_ID>" }).sort({ "processedAt": -1 });
   ```

4. **Retrieve a monitoring event by its ID**:
   ```javascript
   db.monitoring_events.findOne({ "eventId": "<EVENT_ID>" });
   ```
